<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>{% block title %}title{% endblock %} - {{ config.USER_APP_NAME }}</title>
	<link rel="stylesheet" type="text/css" href="/static/bootstrap.css">
	<link rel="stylesheet" type="text/css" href="/static/custom.css?v=14">
	<link rel="search" type="application/opensearchdescription+xml" href="/static/opensearch.xml" title="ContentDB" />
	<link rel="shortcut icon" href="/favicon-16.png" sizes="16x16">
	<link rel="icon" href="/favicon-128.png" sizes="128x128">
	<link rel="icon" href="/favicon-32.png" sizes="32x32">
	{% block headextra %}{% endblock %}
</head>

<body>
	<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
		<div class="container">
			<a class="navbar-brand" href="/">{{ config.USER_APP_NAME }}</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>

			<div class="collapse navbar-collapse" id="navbarColor01">
				<ul class="navbar-nav mr-auto">
					{% for item in current_menu.children recursive %}
						{% if item.visible %}
							<li class="nav-item {% if item.children %} dropdown{% endif %}">
								<a class="nav-link" href="{{ item.url }}"
										{% if item.children %}
											class="dropdown-toggle"
											data-toggle="dropdown"
											role="button"
											aria-expanded="false"
										{% endif %}>
									{{ item.text }}
									{% if item.children %}
										<span class="caret"></span>
									{% endif %}
								</a>
								{% if item.children %}
								<ul class="dropdown-menu" role="menu">
									{{ loop(item.children) }}
								</ul>
								{% endif %}
							</li>
						{% endif %}
					{% endfor %}
				</ul>
				<form class="form-inline my-2 my-lg-0" method="GET" action="/packages/">
					{% if type %}<input type="hidden" name="type" value="{{ type }}" />{% endif %}
					<input class="form-control mr-sm-2" name="q" type="text" placeholder="Search {{ title | lower or 'all packages' }}" value="{{ query or ''}}">
					<input class="btn btn-secondary my-2 my-sm-0 mr-sm-2" type="submit" value="Search" />
					<!-- <input class="btn btn-secondary my-2 my-sm-0"
						data-toggle="tooltip" data-placement="bottom"
						title="Go to the first found result for this query."
						type="submit" name="lucky" value="First" /> -->
				</form>
				<ul class="navbar-nav ml-auto">
					{% if current_user.is_authenticated %}
						{% if todo_list_count is not none %}
							<li class="nav-item">
								<a class="nav-link notification-icon"
											href="{{ url_for('todo.view') }}"
											title="{{ _('Work Queue') }}">
									{% if todo_list_count > 0 %}
										<i class="fas fa-inbox"></i>
										<span class="badge badge-pill badge-notify" style="font-size:10px;">{{ todo_list_count }}</span>
									{% else %}
										<i class="fas fa-inbox" ></i>
									{% endif %}
								</a>
							</li>
						{% endif %}
						<li class="nav-item">
							<a class="nav-link notification-icon"
										href="{{ url_for('notifications.list_all') }}"
										title="{{ _('Notifications') }}">
								{% if current_user.notifications %}
									<i class="fas fa-bell"></i>
									<span class="badge badge-pill badge-notify" style="font-size:10px;">{{ current_user.notifications | length }}</span>
								{% else %}
									<i class="fas fa-bell" ></i>
								{% endif %}
							</a>
						</li>
						<li class="nav-item">
							<a class="nav-link"
									href="{{ url_for('packages.create_edit') }}"
									title="{{ _('Add Package') }}">
								<i class="fas fa-plus"></i>
							</a>
						</li>
						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle"
								data-toggle="dropdown"
								role="button"
								aria-expanded="false">{{ current_user.display_name }}
									<span class="caret"></span></a>

							<ul class="dropdown-menu dropdown-menu-right" role="menu">
								<li class="nav-item">
									<a class="nav-link" href="{{ url_for('users.profile', username=current_user.username) }}">Profile</a>
								</li>
								<li class="nav-item">
									<a class="nav-link" href="{{ url_for('users.profile', username=current_user.username) }}#unadded-topics">Your unadded topics</a>
								</li>
								{% if current_user.canAccessTodoList() %}
									<li class="nav-item"><a class="nav-link" href="{{ url_for('todo.view') }}">{{ _("Work Queue") }}</a></li>
								{% endif %}
								<li class="nav-item"><a  class="nav-link" href="{{ url_for('users.list_all') }}">{{ _("User list") }}</a></li>
								<li class="nav-item">
									<a class="nav-link" href="{{ url_for('todo.topics') }}">{{ _("All unadded topics") }}</a>
								</li>

								{% if current_user.rank.atLeast(current_user.rank.MODERATOR) %}
									<li class="nav-item"><a class="nav-link" href="{{ url_for('admin.audit') }}">{{ _("Audit Log") }}</a></li>
								{% endif %}

								{% if current_user.rank == current_user.rank.ADMIN %}
									<li class="nav-item"><a class="nav-link" href="{{ url_for('admin.admin_page') }}">{{ _("Admin") }}</a></li>
								{% else %}
									{% if check_global_perm(current_user, "EDIT_TAGS") %}
										<li class="nav-item"><a class="nav-link" href="{{ url_for('admin.tag_list') }}">{{ _("Tag Editor") }}</a></li>
									{% elif check_global_perm(current_user, "CREATE_TAG") %}
										<li class="nav-item"><a class="nav-link" href="{{ url_for('admin.create_edit_tag') }}">{{ _("Create Tag") }}</a></li>
									{% endif %}
									{% if current_user.rank == current_user.rank.MODERATOR %}
										<li class="nav-item"><a class="nav-link" href="{{ url_for('admin.license_list') }}">{{ _("License Editor") }}</a></li>
									{% endif %}
								{% endif %}
								<li class="nav-item"><a class="nav-link" href="{{ url_for('user.logout') }}">{{ _("Sign out") }}</a></li>
							</ul>
						</li>
					{% else %}
						<li><a class="nav-link" href="{{ url_for('user.login') }}">{{ _("Sign in") }}</a></li>
					{% endif %}
				</ul>
			</div>
		</div>
	</nav>

	{% block flash_messages %}
		{%- with messages = get_flashed_messages(with_categories=true) -%}
			{% if messages %}
				<ul id="alerts">
					{% for category, message in messages %}
						<li class="alert alert-{{category}} container">
							<span class="icon_message"></span>

							{{ message }}

							<div style="clear: both;"></div>
						</li>
					{% endfor %}
				</ul>
			{% endif %}
		{%- endwith %}
	{% endblock %}

	{% block container %}
	<main class="container mt-4">
		{% block content %}
		{% endblock %}
	</main>
	{% endblock %}

	<footer class="container footer-copyright my-5 page-footer font-small text-center">
		ContentDB &copy; 2018-20 to <a href="https://rubenwardy.com/">rubenwardy</a> |
		<a href="https://github.com/minetest/contentdb">GitHub</a> |
		<a href="{{ url_for('flatpage', path='help') }}">{{ _("Help") }}</a> |
		<a href="{{ url_for('flatpage', path='policy_and_guidance') }}">{{ _("Policy and Guidance") }}</a> |
		<a href="{{ url_for('flatpage', path='help/reporting') }}">{{ _("Report / DMCA") }}</a> |
		<a href="{{ url_for('users.list_all') }}">{{ _("User List") }}</a>

		{% if debug %}
			<p style="color: red">
				DEBUG MODE ENABLED
			</p>
		{% endif %}
	</footer>

	<script src="/static/jquery.min.js"></script>
	<script src="/static/popper.min.js"></script>
	<script src="/static/bootstrap.min.js"></script>
	<script src="/static/easymde.min.js"></script>
	<link rel="stylesheet" type="text/css" href="/static/easymde.min.css">
	<link href="/static/fa/css/all.css" rel="stylesheet">
	<script src="/static/markdowntextarea.js"></script>

	{% block scriptextra %}{% endblock %}
</body>
</html>
